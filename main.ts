// Declare Sprites
let plane: Sprite = null
let cloud: Sprite = null
let coin: Sprite = null
let fuel: Sprite = null
let level = 1
let cloudSpeed = -50
let powerWorth = 10
let cloudSpawnSpeed = 1000
let powerup = false

// Create Plane
plane = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . . . 1 1 e 1 1 . . . . .
    . . . . . . 1 f 1 f 1 . . . . .
    . . . . . . 1 1 f 1 1 . . . . .
    . . . . . . 1 f 1 f 1 . . . . .
    . . . . . . 1 1 1 1 1 . . . . .
    . . . . . . . . e . . . . . . .
    . . . . . . . . e . . . . . . .
    . . . . e e e e e e e e e . . .
    . . . . f e f e f e f e f e . .
    . . . . e e e e e e e e e e . .
    . . . . . e e e e e e e e . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`, SpriteKind.Player)
controller.moveSprite(plane, 0) // 0 means can't move horizontally
plane.setPosition(25, 30)
plane.setFlag(SpriteFlag.StayInScreen, true)

// Scene Settings
scene.setBackgroundImage(img`
    5555555555555555555556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555556666666666666666666666666666666666666666666661111111666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555556666666666666666666666666666666666666666666611111111116666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555566666666666655566666666666666666666666666661111111111111166666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555566666666666655556666666666666666666666666661111111111111111666666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555666666666666655555566666666666666666666666661111111111111111166666666666666666666666666666666666666666666666666666666666666666666666666666666
    5555555555555555555666666666666665555556666666666666666661111111111111111111111111666666666666666666666666666666666666666666666666611111166666666666666666666666
    5555555555555555556666666666666666555555666666666666666611111111111111111111111111166666666666666666666666666666666666666666661111111111111116666666666666666666
    5555555555555555556666666666666666665555556666666666666111111111111111111111111111116666666666666666666666666666666666661111111111111111111116666666666666666666
    5555555555555555566666666666666666666555555666666666666111111111111111111111111111116666666666666666666666666666666611111111111111111111111116666666666666666666
    5555555555555556666666666666666666666655555666666666666111111111111111111111111111116666666666666666666666666666111111111111111111111111111116666666666666666666
    5555555555555666666666666555666666666666555666666666666111111111111111111111111111166666666666666666666666666611111111111111111111111111111111666666666666666666
    5555555666666666666666666555566666666666666666666666666111111111111111111111111111166666666666666666666666661111111111111111111111111111111111666666666666666666
    5555566666666666666666666555556666666666666666666666666111111111111111111111111111166666666666666666666666111111111111111111111111111111111111666666666666666666
    6666666666666666666666666655555666666666666666666666666611111111111111111111111111166666666666666666666611111111111111111111111111111111111111666666666666666666
    6666666666666666666666666665555666666666666666666666666661111111111111111111111111166666666666666666661111111111111111111111111111111111111111666666666666666666
    6666666666666666666666666666555566666666666666666666666666111111111111111111111111166666666666666666611111111111111111111111111111111111111111666666666666666666
    6666666666666555566666666666555555666666666666666666666666611111111111111111111111666666666666666666611111111111111111111111111111111111111111666666666666666666
    6666666666666555566666666666655555666666666666666666666666666111111111111111111116666666666666666666611111111111111111111111111111111111111116666666666666666666
    6666655556666555556666666666665555666666666666666666666666666661111111111111111166666666666666666666611111111111111111111111111111111111111116666666666666666666
    6666655556666655555666666666666555666666666666666666666666666666661111111111111666666666666666666666611111111111111111111111111111111111111116666666666666666666
    6666655556666665555666666666666666666666666666666666666666666666666666666666666666666666666666666666661111111111111111111111111111111111111116666666666666666666
    6666665556666666555566666666666666666666666666666666666666666666666666666666666666666666666666666666666611111111111111111111111111111111111166666666666666666666
    6666665555666666555566666666666666666666666666666666666666666666666666666666666666666666666666666666666666111111111111111111111111111111116666666666666666666666
    6666665555666666655556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666611111111111111111111111111166666666666666666666666
    6666666555666666655556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666111111111111111116666666666666666666666666
    6666666555556666665556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666555556666665556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666655556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666665556666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
`)
info.setScore(0)
info.setLife(3)

// Level ID
game.onUpdate(function() {
    if (level == 1) {
        cloudSpeed = -50
        powerWorth = 10
        if (info.score() >= 20) {
            level = 2
            cloudSpawnSpeed = 900
            info.setScore(0)
            info.setLife(3)
            game.splash("Congrats!", "Level 1 Beaten! (Use Space to Pew-Pew Next Round)!")
        }
    }
    if (level == 2) {
        cloudSpeed = -60
        powerWorth = 5
        if (info.score() >= 30) {
            level = 3
            cloudSpawnSpeed = 850
            info.setScore(0)
            info.setLife(3)
            game.splash("Congrats!", "Level 2 Beaten!")
        }
    }
    if (level == 3) {
        cloudSpeed = -90
        powerWorth = 1
        if (info.score() >= 40) {
            game.over(true)
        }
    }
})

// Spawning Functions
game.onUpdateInterval(1000, function() {
    cloud = sprites.create(img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . 1 1 f f f . . . . .
        . . . . . 1 2 1 2 f 2 f . . . .
        . . . . 1 1 1 1 f f f f f . . .
        . . . . 1 1 1 1 1 f f f f . . .
        . . . . . 1 2 2 2 2 2 f . . . .
        . . . . . . 1 1 f f f . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `, SpriteKind.Enemy)
    cloud.setPosition(150, Math.randomRange(20, 110))
    cloud.setVelocity(cloudSpeed, 0)
})

game.onUpdateInterval(5000, function() {
    coin = sprites.create(img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . 4 4 4 4 . . . . . .
        . . . . . 4 5 5 5 5 4 . . . . .
        . . . . . 4 5 4 4 5 4 . . . . .
        . . . . . 4 5 4 4 5 4 . . . . .
        . . . . . 4 5 5 5 5 4 . . . . .
        . . . . . . 4 4 4 4 . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `, SpriteKind.Food)
    coin.setPosition(150, Math.randomRange(20, 110))
    coin.setVelocity(cloudSpeed, 0)
})

game.onUpdateInterval(15000, function() {
    if (level == 3) {
        fuel = sprites.create(img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . 4 4 4 4 4 4 4 4 . . . .
        . . . . 4 4 4 4 4 4 4 4 . . . .
        . . . . e e e 5 5 e e e . . . .
        . . . . e e e 5 5 e e e . . . .
        . . . . e e e e e e e e . . . .
        . . . . e e e e e e e e . . . .
        . . . . e e e e e e e e . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `, SpriteKind.Food)
        fuel.setPosition(150, Math.randomRange(20, 110))
        fuel.setVelocity(cloudSpeed, 0)
    }
})

// On Overlaps
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function(sprite: Sprite, otherSprite: Sprite) {
    otherSprite.destroy()
    scene.cameraShake(4, 500)
    if (powerup == false) {
        music.powerDown.play()
        info.changeLifeBy(-1)
        info.changeScoreBy(-5)
    } else {
        music.powerUp.play()
    }
})

sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function(sprite: Sprite, otherSprite: Sprite) {
    otherSprite.destroy()
    scene.cameraShake(1, 500)
    music.baDing.play()
    if (otherSprite == coin) {
        info.changeLifeBy(1)
        info.changeScoreBy(powerWorth)
    }
    if (otherSprite == fuel) {
        powerup = true
        plane.startEffect(effects.rings, 5000)
        timer.after(5000, function() {
            powerup = false
        })
    }
})

// Shooting
controller.A.onEvent(ControllerButtonEvent.Pressed, function() {
    if (level >= 2) {
        music.pewPew.play()
        let playerBullet = sprites.createProjectileFromSprite(img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . 3 a 8 7 5 4 2 2 . . . .
            . . . . 3 a 8 7 5 4 2 2 . . . .
            . . . . 3 a 8 7 5 4 2 2 . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
        `, plane, 100, 0)
    }
})

sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Projectile, function(sprite: Sprite, otherSprite: Sprite) {
    sprite.destroy()
    otherSprite.destroy()
    info.changeScoreBy(powerWorth)
    scene.cameraShake(1, 500)
})